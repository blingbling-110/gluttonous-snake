(()=>{"use strict";const t=function(){function t(){this.element=document.getElementById("food")}return Object.defineProperty(t.prototype,"x",{get:function(){return this.element.offsetLeft},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.element.offsetTop},enumerable:!1,configurable:!0}),t.prototype.change=function(){this.element.style.left=10*Math.round(29*Math.random())+"px",this.element.style.top=10*Math.round(29*Math.random())+"px"},t}(),e=function(){function t(){this.isLive=!0,this.bodyArr=[],this.element=document.getElementById("snake"),this.head=document.querySelector("#snake > div"),this.headAndBody=this.element.getElementsByTagName("div")}return Object.defineProperty(t.prototype,"x",{get:function(){return this.head.offsetLeft},set:function(t){this.x!==t&&(this.bodyArr[0]&&this.headAndBody[this.bodyArr[0]].offsetLeft===t&&(t=t>this.x?this.x-10:this.x+10),t<0||t>290||this.isOnSnake(t,this.y,!1)?this.isLive=!1:(this.moveBody(),this.head.style.left=t+"px"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.head.offsetTop},set:function(t){this.y!==t&&(this.bodyArr[0]&&this.headAndBody[this.bodyArr[0]].offsetTop===t&&(t=t>this.y?this.y-10:this.y+10),t<0||t>290||this.isOnSnake(this.x,t,!1)?this.isLive=!1:(this.moveBody(),this.head.style.top=t+"px"))},enumerable:!1,configurable:!0}),t.prototype.addBody=function(){this.element.insertAdjacentHTML("beforeend","<div></div>"),this.bodyArr.length<1?this.bodyArr.push(1):this.bodyArr.push(this.headAndBody.length-1)},t.prototype.moveBody=function(){if(!(this.bodyArr.length<1)){var t=this.bodyArr.pop();this.bodyArr.unshift(t);var e=this.headAndBody[t];e.style.left=this.x+"px",e.style.top=this.y+"px"}},t.prototype.move=function(t,e,i){void 0===i&&(i=!1),i&&this.addBody(),this.x=t,this.y=e},t.prototype.isOnSnake=function(t,e,i){return void 0===i&&(i=!0),Array.from(this.headAndBody).some((function(o,n){return!(0===n&&!i)&&o.offsetLeft===t&&o.offsetTop===e}))},t.prototype.reset=function(){var t=this;Array.from(this.headAndBody).filter((function(e){return e!==t.head})).forEach((function(t){return t.remove()})),this.isLive=!0,this.bodyArr=[],this.x=10*Math.round(29*Math.random()),this.y=10*Math.round(29*Math.random())},t}(),i=function(){function t(t,e){void 0===t&&(t=9),void 0===e&&(e=10),this.score=0,this.level=1,this.maxLevel=t,this.upScore=e,this.scoreEle=document.getElementById("score"),this.levelEle=document.getElementById("level")}return t.prototype.addScore=function(){this.setScore(this.score+1),this.score%this.upScore==0&&this.levelup()},t.prototype.levelup=function(){this.level<this.maxLevel&&this.setLevel(this.level+1)},t.prototype.setScore=function(t){this.score=t,this.scoreEle.textContent=t+""},t.prototype.setLevel=function(t){this.level=t,this.levelEle.textContent=t+""},t}();var o=[["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"],["Up","Right","Down","Left"],["w","d","s","a"],["W","D","S","A"]];(new(function(){function n(){this.direction=-1,this.snake=new e,this.food=new t,this.panel=new i}return n.prototype.init=function(){document.addEventListener("keydown",this.keyDownCb.bind(this)),document.addEventListener("touchstart",this.touchStartCb.bind(this)),this.reset()},n.prototype.keyDownCb=function(t){var e=this;o.some((function(i){var o=i.findIndex((function(e){return t.key===e}));return-1!==o&&(e.direction=o,!0)}))},n.prototype.touchStartCb=function(t){var e=t.touches[0],i=e.clientX,o=e.clientY,n=this.snake.head.getBoundingClientRect(),s=n.x+5,r=n.y+5,h=document.querySelector("#main .icon-wrapper"),d=document.elementFromPoint(i,o);if(!h.contains(d))if(i!==s){var a=Math.abs((o-r)/(i-s));a>1&&o<r?this.direction=0:a>1&&o>r?this.direction=2:a<1&&i<s?this.direction=3:a<1&&i>s&&(this.direction=1)}else o<r?this.direction=0:o>r&&(this.direction=2)},n.prototype.draw=function(){var t=this.snake.x,e=this.snake.y;switch(this.direction){case 0:e-=10;break;case 1:t+=10;break;case 2:e+=10;break;case 3:t-=10}var i=t===this.food.x&&e===this.food.y;i&&(this.changeFood(),this.panel.addScore()),this.snake.move(t,e,i),this.snake.isLive?setTimeout(this.draw.bind(this),300-30*this.panel.level):(alert("游戏结束！"),this.reset())},n.prototype.changeFood=function(){do{this.food.change()}while(this.snake.isOnSnake(this.food.x,this.food.y))},n.prototype.reset=function(){this.snake.reset(),this.direction=-1,this.changeFood(),this.panel.setScore(0),this.panel.setLevel(1),this.draw()},n}())).init()})();